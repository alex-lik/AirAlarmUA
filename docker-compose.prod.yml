version: '3.8'

services:
  air-alert-api:
    build: .
    container_name: air-alert-api
    ports:
      - "8000:8000"
    restart: unless-stopped
    environment:
      # Основные переменные окружения для продакшена
      - PORT=8000
      - ENVIRONMENT=production
      - LOG_LEVEL=INFO
      - CORS_ORIGINS=["*"]
      - UPDATE_INTERVAL=30
      - REQUEST_TIMEOUT=10
      - MAX_RETRIES=3
      - RATE_LIMIT="100/minute"
      # Sentry DSN (должен быть установлен через секреты)
      - SENTRY_DSN=${SENTRY_DSN}
      # Telegram настройки
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_IDS=${TELEGRAM_CHAT_IDS}
      - IS_TELEGRAM_ENABLED=true
      # Метрики
      - IS_PROMETHEUS_ENABLED=true
      - PROMETHEUS_PORT=9091
    env_file:
      # Используем env_file только если он существует, но не перезаписываем его
      - .env
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    volumes:
      # Не монтируем весь каталог, только логи если нужно
      # - ./logs:/app/logs
    networks:
      - air-alert-network

networks:
  air-alert-network:
    driver: bridge